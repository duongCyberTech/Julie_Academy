generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Answer_for_exam {
  et_id      String
  ques_id    String
  aid        Int
  Exam_taken Exam_taken @relation(fields: [et_id], references: [et_id])
  Answers    Answers    @relation(fields: [ques_id, aid], references: [ques_id, aid])

  @@id([et_id, ques_id, aid])
}

model Answers {
  ques_id            String
  aid                Int
  content            String
  is_correct         Boolean              @default(false)
  explaination       String?
  Answer_for_exam    Answer_for_exam[]
  Questions          Questions            @relation(fields: [ques_id], references: [ques_id])
  Resource_of_Answer Resource_of_Answer[]

  @@id([ques_id, aid])
}

model Badge {
  badge_id    String        @id
  title       String
  description String
  badge_type  BadgeType
  badge_url   String?
  func_type   AggregateType
  threshold   Int
  value_type  ValueType
  Claim       Claim[]
}

model Categories {
  category_id      String            @id
  category_name    String
  description      String?
  createAt         DateTime          @default(now())
  updateAt         DateTime          @default(now())
  parent_id        String?
  Categories       Categories?       @relation("CategoriesToCategories", fields: [parent_id], references: [category_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_recursive_cate")
  other_Categories Categories[]      @relation("CategoriesToCategories")
  Folder_of_class  Folder_of_class[]
  Model            Model[]
  Questions        Questions[]
  Structure        Structure[]
}

model Claim {
  student_id  String
  badge_id    String
  claim_at    DateTime @default(now())
  claim_level Int      @default(1)
  Badge       Badge    @relation(fields: [badge_id], references: [badge_id])
  Student     Student  @relation(fields: [student_id], references: [uid])

  @@id([student_id, badge_id])
}

model Class {
  class_id        String            @id
  classname       String
  description     String
  createdAt       DateTime          @default(now())
  updateAt        DateTime          @default(now())
  duration_time   Int
  nb_of_student   Int
  status          ClassStatus       @default(pending)
  grade           Int
  subject         String
  tutor_uid       String
  startat         DateTime?         @default(now()) @db.Timestamp(6)
  plan_id         String?
  Lesson_Plan     Lesson_Plan?      @relation(fields: [plan_id], references: [plan_id])
  Tutor           Tutor             @relation(fields: [tutor_uid], references: [uid])
  Exam_open_in    Exam_open_in[]
  Folder_of_class Folder_of_class[]
  Learning        Learning[]
  Review          Review[]
  Schedule        Schedule[]
}

model Comments {
  thread_id           String
  comment_id          String
  content             String
  createAt            DateTime              @default(now())
  updateAt            DateTime              @default(now())
  uid                 String
  Thread              Thread                @relation(fields: [thread_id], references: [thread_id])
  User                User                  @relation(fields: [uid], references: [uid])
  Resource_of_Comment Resource_of_Comment[]

  @@id([thread_id, comment_id])
}

model Exam_open_in {
  session_id   Int
  exam_id      String
  class_id     String
  ratio        Int?
  Class        Class        @relation(fields: [class_id], references: [class_id])
  Exam_session Exam_session @relation(fields: [session_id, exam_id], references: [session_id, exam_id])

  @@id([session_id, exam_id, class_id])
}

model Exam_session {
  exam_id            String
  session_id         Int
  startAt            DateTime       @default(now())
  expireAt           DateTime
  exam_type          ExamType       @default(practice)
  limit_taken        Int            @default(1)
  total_student_done Int            @default(0)
  Exam_open_in       Exam_open_in[]
  Exams              Exams          @relation(fields: [exam_id], references: [exam_id])

  @@id([exam_id, session_id])
}

model Exam_taken {
  et_id                String            @id
  final_score          Int
  total_ques_completed Int
  startAt              DateTime          @default(now())
  doneAt               DateTime          @default(now())
  exam_id              String?
  session_id           Int?
  student_uid          String
  Answer_for_exam      Answer_for_exam[]
  Student              Student           @relation(fields: [student_uid], references: [uid])
}

model Exams {
  exam_id          String             @id
  title            String
  description      String?
  level            DifficultyLevel    @default(easy)
  duration         Int
  total_score      Int
  total_ques       Int
  createdAt        DateTime           @default(now())
  updateAt         DateTime           @default(now())
  tutor_id         String
  Exam_session     Exam_session[]
  Tutor            Tutor              @relation(fields: [tutor_id], references: [uid])
  Question_of_exam Question_of_exam[]
}

model Feedback {
  feed_id     String   @id
  content     String
  createdAt   DateTime @default(now())
  tutor_uid   String
  student_uid String
  Student     Student  @relation(fields: [student_uid], references: [uid])
  Tutor       Tutor    @relation(fields: [tutor_uid], references: [uid])
}

model Folder_of_class {
  category_id String
  class_id    String
  folder_id   String
  status      ResourceStatus @default(show)
  Categories  Categories     @relation(fields: [category_id], references: [category_id])
  Class       Class          @relation(fields: [class_id], references: [class_id])
  Folders     Folders        @relation(fields: [folder_id], references: [folder_id])

  @@id([category_id, class_id, folder_id])
}

model Folders {
  folder_id           String                @id
  folder_name         String
  createdAt           DateTime              @default(now())
  updateAt            DateTime              @default(now())
  tutor_id            String
  parent_id           String?
  Folder_of_class     Folder_of_class[]
  Folders             Folders?              @relation("FoldersToFolders", fields: [parent_id], references: [folder_id], onDelete: NoAction, onUpdate: NoAction, map: "Child_folder_fkey")
  other_Folders       Folders[]             @relation("FoldersToFolders")
  Tutor               Tutor                 @relation(fields: [tutor_id], references: [uid])
  Resources_in_folder Resources_in_folder[]
}

model Follow {
  thread_id String
  uid       String
  Thread    Thread @relation(fields: [thread_id], references: [thread_id])
  User      User   @relation(fields: [uid], references: [uid])

  @@id([thread_id, uid])
}

model Learning {
  class_id    String
  student_uid String
  status      EnrollStatus @default(pending)
  Class       Class        @relation(fields: [class_id], references: [class_id])
  Student     Student      @relation(fields: [student_uid], references: [uid])

  @@id([class_id, student_uid])
}

model Lesson_Plan {
  plan_id     String      @id @db.VarChar(255)
  title       String      @unique @db.VarChar(255)
  subject     String      @db.VarChar(20)
  grade       Int         @db.SmallInt
  description String?
  type        PlanType    @default(custom)
  tutor_id    String?
  Class       Class[]
  Tutor       Tutor?      @relation(fields: [tutor_id], references: [uid])
  Model       Model[]
  Structure   Structure[]
}

model Model {
  model_id    String      @id
  init        Decimal     @db.Decimal(4, 2)
  transit     Decimal     @db.Decimal(4, 2)
  guess       Decimal     @db.Decimal(4, 2)
  slip        Decimal     @db.Decimal(4, 2)
  student_id  String
  plan_id     String
  category_id String
  Categories  Categories  @relation(fields: [category_id], references: [category_id])
  Lesson_Plan Lesson_Plan @relation(fields: [plan_id], references: [plan_id])
  Student     Student     @relation(fields: [student_id], references: [uid])
}

model Parents {
  uid          String      @id
  phone_number String?     @unique
  User         User        @relation(fields: [uid], references: [uid])
  is_family    is_family[]
}

model Question_of_exam {
  exam_id   String
  ques_id   String
  score     Decimal   @default(0.00) @db.Decimal(4, 2)
  Exams     Exams     @relation(fields: [exam_id], references: [exam_id])
  Questions Questions @relation(fields: [ques_id], references: [ques_id])

  @@id([exam_id, ques_id])
}

model Questions {
  ques_id              String                 @id
  content              String
  explaination         String?
  type                 QuestionType           @default(single_choice)
  level                DifficultyLevel        @default(easy)
  createAt             DateTime               @default(now())
  updateAt             DateTime               @default(now())
  category_id          String?
  tutor_id             String
  status               QuestionStatus         @default(draft)
  accessMode           QuestionAccess         @default(private)
  title                String
  Answers              Answers[]
  Question_of_exam     Question_of_exam[]
  Categories           Categories?            @relation(fields: [category_id], references: [category_id])
  Tutor                Tutor                  @relation(fields: [tutor_id], references: [uid])
  Resource_of_Question Resource_of_Question[]
}

model Resource_of_Answer {
  did       String    @db.VarChar(255)
  aid       Int       @db.SmallInt
  ques_id   String    @db.VarChar(255)
  Resources Resources @relation(fields: [did], references: [did], onDelete: NoAction, onUpdate: NoAction)
  Answers   Answers   @relation(fields: [ques_id, aid], references: [ques_id, aid], onDelete: NoAction, onUpdate: NoAction)

  @@id([did, aid, ques_id])
}

model Resource_of_Comment {
  thread_id  String    @db.VarChar(255)
  comment_id String    @db.VarChar(255)
  did        String    @db.VarChar(255)
  Resources  Resources @relation(fields: [did], references: [did], onDelete: NoAction, onUpdate: NoAction)
  Comments   Comments  @relation(fields: [thread_id, comment_id], references: [thread_id, comment_id], onDelete: NoAction, onUpdate: NoAction)

  @@id([did, comment_id, thread_id])
}

model Resource_of_Question {
  did       String    @db.VarChar(255)
  ques_id   String    @db.VarChar(255)
  Resources Resources @relation(fields: [did], references: [did], onDelete: NoAction, onUpdate: NoAction)
  Questions Questions @relation(fields: [ques_id], references: [ques_id], onDelete: NoAction, onUpdate: NoAction)

  @@id([did, ques_id])
}

model Resource_of_Thread {
  thread_id String    @db.VarChar(255)
  did       String    @db.VarChar(255)
  Resources Resources @relation(fields: [did], references: [did], onDelete: NoAction, onUpdate: NoAction)
  Thread    Thread    @relation(fields: [thread_id], references: [thread_id], onDelete: NoAction, onUpdate: NoAction)

  @@id([did, thread_id])
}

model Resources {
  did                  String                 @id
  title                String
  description          String
  createAt             DateTime               @default(now())
  updateAt             DateTime               @default(now())
  file_type            String
  file_path            String
  version              Int
  num_pages            Int
  tutor_id             String
  Resource_of_Answer   Resource_of_Answer[]
  Resource_of_Comment  Resource_of_Comment[]
  Resource_of_Question Resource_of_Question[]
  Resource_of_Thread   Resource_of_Thread[]
  Tutor                Tutor                  @relation(fields: [tutor_id], references: [uid])
  Resources_in_folder  Resources_in_folder[]
}

model Resources_in_folder {
  resource_id String
  folder_id   String
  status      ResourceStatus @default(show)
  Folders     Folders        @relation(fields: [folder_id], references: [folder_id])
  Resources   Resources      @relation(fields: [resource_id], references: [did])

  @@id([resource_id, folder_id])
}

model Review {
  student_id String
  class_id   String
  createAt   DateTime @default(now())
  content    String
  rating     Decimal  @db.Decimal(3, 1)
  Class      Class    @relation(fields: [class_id], references: [class_id])
  Student    Student  @relation(fields: [student_id], references: [uid])

  @@id([student_id, class_id])
}

model Schedule {
  schedule_id  Int
  class_id     String
  startAt      String
  endAt        String
  link_meet    String
  meeting_date Decimal @db.Decimal
  Class        Class   @relation(fields: [class_id], references: [class_id])

  @@id([schedule_id, class_id])
}

model Structure {
  plan_id     String
  cate_id     String
  Categories  Categories  @relation(fields: [cate_id], references: [category_id])
  Lesson_Plan Lesson_Plan @relation(fields: [plan_id], references: [plan_id])

  @@id([plan_id, cate_id])
}

model Student {
  uid        String       @id
  school     String?
  dob        DateTime?
  Claim      Claim[]
  Exam_taken Exam_taken[]
  Feedback   Feedback[]
  Learning   Learning[]
  Model      Model[]
  Review     Review[]
  User       User         @relation(fields: [uid], references: [uid])
  is_family  is_family[]
}

model Thread {
  thread_id          String               @id
  title              String
  content            String
  createAt           DateTime             @default(now())
  updateAt           DateTime             @default(now())
  uid                String
  Comments           Comments[]
  Follow             Follow[]
  Resource_of_Thread Resource_of_Thread[]
  User               User                 @relation(fields: [uid], references: [uid])
}

model Tutor {
  uid          String        @id
  phone_number String?       @unique
  experiences  String?
  Class        Class[]
  Exams        Exams[]
  Feedback     Feedback[]
  Folders      Folders[]
  Lesson_Plan  Lesson_Plan[]
  Questions    Questions[]
  Resources    Resources[]
  User         User          @relation(fields: [uid], references: [uid])
}

model User {
  uid       String        @id
  username  String        @unique
  fname     String
  mname     String
  lname     String
  email     String        @unique
  password  String
  createAt  DateTime      @default(now())
  role      UserRole      @default(student)
  status    AccountStatus @default(inactive)
  avata_url String?
  Comments  Comments[]
  Follow    Follow[]
  Parents   Parents?
  Student   Student?
  Thread    Thread[]
  Tutor     Tutor?
}

model is_family {
  student_uid String
  parents_uid String
  Parents     Parents @relation(fields: [parents_uid], references: [uid])
  Student     Student @relation(fields: [student_uid], references: [uid])

  @@id([student_uid, parents_uid])
}

enum AccountStatus {
  active
  inactive
}

enum AggregateType {
  sum
  avg
  num
  incre
}

enum BadgeType {
  exam
  exam_practice
  exam_test
  thread
  thread_comment
  question_correct
  score
  score_test
  score_practice
  streak
}

enum ClassStatus {
  pending
  ongoing
  completed
  cancelled
}

enum DifficultyLevel {
  easy
  medium
  hard
}

enum EnrollStatus {
  pending
  accepted
  cancelled
  completed
}

enum ExamType {
  practice
  test
  final
}

enum PlanType {
  book
  custom
}

enum QuestionAccess {
  private
  public
}

enum QuestionStatus {
  draft
  ready
}

enum QuestionType {
  single_choice
  multiple_choice
  true_false
  short_answer
  essay
}

enum ResourceStatus {
  show
  hidden
}

enum UserRole {
  admin
  tutor
  student
  parents
}

enum ValueType {
  value
  percent
}
